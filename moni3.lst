 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 1 - 2025年01月22日 16時09分20秒


    1/   0 :                            ;/*
    2/   0 :                            ; ===========================================
    3/   0 :                            ; *	SC/MP-III Sample Program
    4/   0 :                            ; ===========================================
    5/   0 :                            ; */
    6/   0 :                            ;
    7/   0 :                            ; プリアンブル
    8/   0 :                            ; ------------
    9/   0 :                            	  cpu 8070
   10/   0 :                            	  org 0
   11/   0 :                            
   12/   0 : =0xFF80                    wk1  = 0xff80
   13/   0 : =0xFF81                    cnt1 = 0xff81
   14/   0 : =0xFF82                    cnt2 = 0xff82
   15/   0 : =0xFF83                    r4   = 0xff83
   16/   0 : =0xFF84                    p4   = 0xff84
   17/   0 : =0xFF86                    p5   = 0xff86
   18/   0 :                            
   19/   0 :                            ; ------------
   20/   0 :                            ; ワークエリア
   21/   0 : =0xFFA0                    q0 = 0xffa0
   22/   0 : =0xFFA1                    q1 = 0xffa1
   23/   0 : =0xFFA2                    q2 = 0xffa2
   24/   0 : =0xFFA3                    q3 = 0xffa3
   25/   0 : =0xFFA4                    q4 = 0xffa4
   26/   0 : =0xFFA5                    q5 = 0xffa5
   27/   0 :                            
   28/   0 : =0xFFA8                    r0 = 0xffa8
   29/   0 : =0xFFAA                    r1 = 0xffaa
   30/   0 : =0xFFAC                    r2 = 0xffac
   31/   0 : =0xFFAE                    r3 = 0xffae
   32/   0 : =0xFFB0                    cyr0 = 0xffb0
   33/   0 : =0xFFB1                    cyr1 = 0xffb1
   34/   0 : =0xFFB2                    cyr2 = 0xffb2
   35/   0 :                            
   36/   0 :                            ;// スタート
   37/   0 :                            ;	 nop;
   38/   0 : 00                         	nop
   39/   1 :                            ;	 sp=0x8000;
   40/   1 : 25 00 80                   	ld	sp, =0x8000
   41/   4 :                            ;	 jmp(main);
   42/   4 : 24 0C 00                   	jmp	main
   43/   7 :                            ;
   44/   7 :                            ;getc()
   45/   7 :                            ;{
   46/   7 :                            getc:
   47/   7 :                            ;     db(2);
   48/   7 : 02                         	db	2
   49/   8 :                            ;}
   50/   8 : 5C                         	ret
   51/   9 :                            ;putc()
   52/   9 :                            ;{
   53/   9 :                            putc:
   54/   9 :                            ;     db(3);
   55/   9 : 03                         	db	3
   56/   A :                            ;}
   57/   A : 5C                         	ret
   58/   B :                            ;exit()
   59/   B :                            ;{
   60/   B :                            exit:
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 2 - 2025年01月22日 16時09分20秒


   61/   B :                            ;     db(4);
   62/   B : 04                         	db	4
   63/   C :                            ;}
   64/   C : 5C                         	ret
   65/   D :                            ;
   66/   D :                            ;// メイン
   67/   D :                            ;main()
   68/   D :                            ;{
   69/   D :                            main:
   70/   D :                            ;	p2=#msg1;puts();	
   71/   D : 26 F1 01                   	ld	p2, =msg1
   72/  10 : 20 CF 01                   	jsr	puts
   73/  13 :                            ;
   74/  13 :                            ;	div_test();
   75/  13 : 20 CC 02                   	jsr	div_test
   76/  16 :                            ;	
   77/  16 :                            ;//	benchmark();
   78/  16 :                            ;
   79/  16 :                            ;	while(1) {	
   80/  16 :                            __wh000:
   81/  16 :                            ;		a='>';putc();
   82/  16 : C4 3E                      	ld	a, ='>'
   83/  18 : 20 08 00                   	jsr	putc
   84/  1B :                            ;		p2=#inbuf;gets();
   85/  1B : 26 0A 02                   	ld	p2, =inbuf
   86/  1E : 20 D9 01                   	jsr	gets
   87/  21 :                            ;
   88/  21 :                            ;		// ECHO BACK.
   89/  21 :                            ;		p2=#inbuf;puts();
   90/  21 : 26 0A 02                   	ld	p2, =inbuf
   91/  24 : 20 CF 01                   	jsr	puts
   92/  27 :                            ;
   93/  27 :                            ;		//
   94/  27 :                            ;		p2=#inbuf;cmd();
   95/  27 : 26 0A 02                   	ld	p2, =inbuf
   96/  2A : 20 61 00                   	jsr	cmd
   97/  2D :                            ;	}
   98/  2D : 24 15 00                   	jmp	__wh000
   99/  30 :                            __ew000:
  100/  30 :                            ;	exit();
  101/  30 : 20 0A 00                   	jsr	exit
  102/  33 :                            ;}
  103/  33 : 5C                         	ret
  104/  34 :                            ;
  105/  34 :                            ;benchmark()
  106/  34 :                            ;{
  107/  34 :                            benchmark:
  108/  34 :                            ;	cnt1=0;
  109/  34 : C4 00                      	ld	a, =0
  110/  36 : CD 81                      	st	a,cnt1
  111/  38 :                            ;	do {
  112/  38 :                            __do001:
  113/  38 :                            ;		cnt2=0;
  114/  38 : C4 00                      	ld	a, =0
  115/  3A : CD 82                      	st	a,cnt2
  116/  3C :                            ;		do {
  117/  3C :                            __do002:
  118/  3C :                            ;			bench_subr();
  119/  3C : 20 50 00                   	jsr	bench_subr
  120/  3F :                            ;		}while(--cnt2);
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 3 - 2025年01月22日 16時09分20秒


  121/  3F : 9D 82                      	dld	A,cnt2
  122/  41 : 7C F9                      	bnz	__do002
  123/  43 :                            __od002:
  124/  43 :                            ;	}while(--cnt1);
  125/  43 : 9D 81                      	dld	A,cnt1
  126/  45 : 7C F1                      	bnz	__do001
  127/  47 :                            __od001:
  128/  47 :                            ;	p2=#msg1;puts();	
  129/  47 : 26 F1 01                   	ld	p2, =msg1
  130/  4A : 20 CF 01                   	jsr	puts
  131/  4D :                            ;	exit();
  132/  4D : 20 0A 00                   	jsr	exit
  133/  50 :                            ;}
  134/  50 : 5C                         	ret
  135/  51 :                            ;
  136/  51 :                            ;bench_subr()
  137/  51 :                            ;{
  138/  51 :                            bench_subr:
  139/  51 :                            ;	p4=0;
  140/  51 : C4 00                      	ld	a, =0
  141/  53 : CD 84                      	st	a,p4
  142/  55 :                            ;	do {
  143/  55 :                            __do003:
  144/  55 :                            ;		bench_subr2();
  145/  55 : 20 5C 00                   	jsr	bench_subr2
  146/  58 :                            ;	}while(--p4);
  147/  58 : 9D 84                      	dld	A,p4
  148/  5A : 7C F9                      	bnz	__do003
  149/  5C :                            __od003:
  150/  5C :                            ;}
  151/  5C : 5C                         	ret
  152/  5D :                            ;bench_subr2()
  153/  5D :                            ;{
  154/  5D :                            bench_subr2:
  155/  5D :                            ;	push(ea);
  156/  5D : 08                         	push	ea
  157/  5E :                            ;	push(ea);
  158/  5E : 08                         	push	ea
  159/  5F :                            ;	pop(ea);
  160/  5F : 3A                         	pop	ea
  161/  60 :                            ;	pop(ea);
  162/  60 : 3A                         	pop	ea
  163/  61 :                            ;}
  164/  61 : 5C                         	ret
  165/  62 :                            ;
  166/  62 :                            ;// P2 ポインタの１行バッファをcmd解釈.
  167/  62 :                            ;// ワーク：
  168/  62 :                            ;//    p4 = readhex()の戻り値.
  169/  62 :                            ;//    p5 = 注目メモリーアドレスを覚えておく.
  170/  62 :                            ;cmd()
  171/  62 :                            ;{
  172/  62 :                            cmd:
  173/  62 :                            ;	a=*p2++;lc();e=a;
  174/  62 : C6 01                      	ld	a, @1,p2
  175/  64 : 20 43 01                   	jsr	lc
  176/  67 : 48                         	ld	e,a
  177/  68 :                            ;	if(e=='d') {
  178/  68 : 40                         	ld	a,e
  179/  69 : FC 64                      	sub	a, ='d'
  180/  6B : 7C 19                      	bnz	__el004
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 4 - 2025年01月22日 16時09分20秒


  181/  6D :                            ;		sp_skip();
  182/  6D : 20 8E 00                   	jsr	sp_skip
  183/  70 :                            ;		readhex();
  184/  70 : 20 A7 00                   	jsr	readhex
  185/  73 :                            ;		if(a!=0) {
  186/  73 : 6C 04                      	bz	__el005
  187/  75 :                            ;			ea=p4;
  188/  75 : 85 84                      	ld	ea,p4
  189/  77 :                            ;			p5=ea;
  190/  77 : 8D 86                      	st	ea,p5
  191/  79 :                            ;		}
  192/  79 :                            ;		ea=p5;p2=ea;mdump(); //メモリーダンプの実行.
  193/  79 :                            __el005:
  194/  79 : 85 86                      	ld	ea,p5
  195/  7B : 46                         	ld	p2,ea
  196/  7C : 20 56 01                   	jsr	mdump
  197/  7F :                            ;
  198/  7F :                            ;		ea=p5;ea+=0x100;p5=ea;
  199/  7F : 85 86                      	ld	ea,p5
  200/  81 : B4 00 01                   	add	ea, =0x100
  201/  84 : 8D 86                      	st	ea,p5
  202/  86 :                            ;	}	
  203/  86 :                            ;	if(e=='q') {
  204/  86 :                            __el004:
  205/  86 : 40                         	ld	a,e
  206/  87 : FC 71                      	sub	a, ='q'
  207/  89 : 7C 03                      	bnz	__el006
  208/  8B :                            ;		exit();
  209/  8B : 20 0A 00                   	jsr	exit
  210/  8E :                            ;	}	
  211/  8E :                            ;}
  212/  8E :                            __el006:
  213/  8E : 5C                         	ret
  214/  8F :                            ;
  215/  8F :                            ;// ==========================================
  216/  8F :                            ;// 入力関数
  217/  8F :                            ;
  218/  8F :                            ;// P2 ポインタの空白文字飛ばし.
  219/  8F :                            ;sp_skip()
  220/  8F :                            ;{
  221/  8F :                            sp_skip:
  222/  8F :                            ;	a=*p2;
  223/  8F : C2 00                      	ld	a, 0,p2
  224/  91 :                            ;	while(a==' ') {
  225/  91 :                            __wh007:
  226/  91 : FC 20                      	sub	a, =' '
  227/  93 : 7C 07                      	bnz	__ew007
  228/  95 :                            ;		a=*p2++;  // p2++ だけしたい.
  229/  95 : C6 01                      	ld	a, @1,p2
  230/  97 :                            ;		a=*p2;
  231/  97 : C2 00                      	ld	a, 0,p2
  232/  99 :                            ;	}
  233/  99 : 24 90 00                   	jmp	__wh007
  234/  9C :                            __ew007:
  235/  9C :                            ;}
  236/  9C : 5C                         	ret
  237/  9D :                            ;
  238/  9D :                            ;p4mul16()
  239/  9D :                            ;{
  240/  9D :                            p4mul16:
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 5 - 2025年01月22日 16時09分20秒


  241/  9D :                            ;	push(ea);
  242/  9D : 08                         	push	ea
  243/  9E :                            ;	ea=p4;
  244/  9E : 85 84                      	ld	ea,p4
  245/  A0 :                            ;	sl(ea);
  246/  A0 : 0F                         	sl	ea
  247/  A1 :                            ;	sl(ea);
  248/  A1 : 0F                         	sl	ea
  249/  A2 :                            ;	sl(ea);
  250/  A2 : 0F                         	sl	ea
  251/  A3 :                            ;	sl(ea);
  252/  A3 : 0F                         	sl	ea
  253/  A4 :                            ;	p4=ea;
  254/  A4 : 8D 84                      	st	ea,p4
  255/  A6 :                            ;	pop(ea);
  256/  A6 : 3A                         	pop	ea
  257/  A7 :                            ;}
  258/  A7 : 5C                         	ret
  259/  A8 :                            ;
  260/  A8 :                            ;// P2 ポインタから16進HEX読み. ==> p4に結果. 入力された桁数=Areg
  261/  A8 :                            ;readhex()
  262/  A8 :                            ;{
  263/  A8 :                            readhex:
  264/  A8 :                            ;	ea=0;
  265/  A8 : 84 00 00                   	ld	ea, =0
  266/  AB :                            ;	p4=ea;
  267/  AB : 8D 84                      	st	ea,p4
  268/  AD :                            ;	r4=a;
  269/  AD : CD 83                      	st	a,r4
  270/  AF :                            ;	while(1) {
  271/  AF :                            __wh008:
  272/  AF :                            ;		a=*p2++;e=a;
  273/  AF : C6 01                      	ld	a, @1,p2
  274/  B1 : 48                         	ld	e,a
  275/  B2 :                            ;		readhex1();e=a;
  276/  B2 : 20 D6 00                   	jsr	readhex1
  277/  B5 : 48                         	ld	e,a
  278/  B6 :                            ;		if(e!=0xff) {
  279/  B6 : 40                         	ld	a,e
  280/  B7 : FC FF                      	sub	a, =0xff
  281/  B9 : 6C 15                      	bz	__el009
  282/  BB :                            ;			p4mul16();
  283/  BB : 20 9C 00                   	jsr	p4mul16
  284/  BE :                            ;			a=e;
  285/  BE : 40                         	ld	a,e
  286/  BF :                            ;			e<>a; a=0; e<>a; //e=0;
  287/  BF : 01                         	xch	e,a
  288/  C0 : C4 00                      	ld	a, =0
  289/  C2 : 01                         	xch	e,a
  290/  C3 :                            ;			ea+=p4;
  291/  C3 : B5 84                      	add	ea,p4
  292/  C5 :                            ;			p4=ea;
  293/  C5 : 8D 84                      	st	ea,p4
  294/  C7 :                            ;			a=r4;a+=1;r4=a;
  295/  C7 : C5 83                      	ld	a,r4
  296/  C9 : F4 01                      	add	a, =1
  297/  CB : CD 83                      	st	a,r4
  298/  CD :                            ;		}else{
  299/  CD : 24 D2 00                   	jmp	__fi009
  300/  D0 :                            __el009:
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 6 - 2025年01月22日 16時09分20秒


  301/  D0 :                            ;			a=r4;
  302/  D0 : C5 83                      	ld	a,r4
  303/  D2 :                            ;			return;
  304/  D2 : 5C                         	ret
  305/  D3 :                            ;		}
  306/  D3 :                            __fi009:
  307/  D3 :                            ;	}
  308/  D3 : 24 AE 00                   	jmp	__wh008
  309/  D6 :                            __ew008:
  310/  D6 :                            ;}
  311/  D6 : 5C                         	ret
  312/  D7 :                            ;
  313/  D7 :                            ;readhex1()
  314/  D7 :                            ;{
  315/  D7 :                            readhex1:
  316/  D7 :                            ;	lc();e=a;
  317/  D7 : 20 43 01                   	jsr	lc
  318/  DA : 48                         	ld	e,a
  319/  DB :                            ;	if(e>='0') {
  320/  DB : 40                         	ld	a,e
  321/  DC : FC 30                      	sub	a, ='0'
  322/  DE : 64 02                      	bp	$+4
  323/  E0 : 74 09                      	bra	__el010
  324/  E2 :                            ;		if(e<0x3a) { // <='9'
  325/  E2 : 40                         	ld	a,e
  326/  E3 : FC 3A                      	sub	a, =0x3a
  327/  E5 : 64 04                      	bp	__el011
  328/  E7 :                            ;			a=e;
  329/  E7 : 40                         	ld	a,e
  330/  E8 :                            ;			a-=0x30;
  331/  E8 : FC 30                      	sub	a, =0x30
  332/  EA :                            ;			return;
  333/  EA : 5C                         	ret
  334/  EB :                            ;		}
  335/  EB :                            ;	}
  336/  EB :                            __el011:
  337/  EB :                            ;	if(e>='a') {
  338/  EB :                            __el010:
  339/  EB : 40                         	ld	a,e
  340/  EC : FC 61                      	sub	a, ='a'
  341/  EE : 64 02                      	bp	$+4
  342/  F0 : 74 09                      	bra	__el012
  343/  F2 :                            ;		if(e<'g') {
  344/  F2 : 40                         	ld	a,e
  345/  F3 : FC 67                      	sub	a, ='g'
  346/  F5 : 64 04                      	bp	__el013
  347/  F7 :                            ;			a=e;
  348/  F7 : 40                         	ld	a,e
  349/  F8 :                            ;			a-=0x57;  // 0x61 - 10
  350/  F8 : FC 57                      	sub	a, =0x57
  351/  FA :                            ;			return;
  352/  FA : 5C                         	ret
  353/  FB :                            ;		}
  354/  FB :                            ;	}
  355/  FB :                            __el013:
  356/  FB :                            ;	a=0xff;
  357/  FB :                            __el012:
  358/  FB : C4 FF                      	ld	a, =0xff
  359/  FD :                            ;}
  360/  FD : 5C                         	ret
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 7 - 2025年01月22日 16時09分20秒


  361/  FE :                            ;
  362/  FE :                            ;
  363/  FE :                            ;// ==========================================
  364/  FE :                            ;// 出力関数
  365/  FE :                            ;
  366/  FE :                            ;//  アスキーダンプ１行
  367/  FE :                            ;ascdump_16()
  368/  FE :                            ;{
  369/  FE :                            ascdump_16:
  370/  FE :                            ;	push(p2);
  371/  FE : 56                         	push	p2
  372/  FF :                            ;	p2=ea;
  373/  FF : 46                         	ld	p2,ea
  374/ 100 :                            ;	ascdump_8();
  375/ 100 : 20 0A 01                   	jsr	ascdump_8
  376/ 103 :                            ;	pr_spc();
  377/ 103 : 20 BE 01                   	jsr	pr_spc
  378/ 106 :                            ;	ascdump_8();
  379/ 106 : 20 0A 01                   	jsr	ascdump_8
  380/ 109 :                            ;	pop(p2);
  381/ 109 : 5E                         	pop	p2
  382/ 10A :                            ;}
  383/ 10A : 5C                         	ret
  384/ 10B :                            ;
  385/ 10B :                            ;//  アスキーダンプ8byte
  386/ 10B :                            ;ascdump_8()
  387/ 10B :                            ;{
  388/ 10B :                            ascdump_8:
  389/ 10B :                            ;	a=8;cnt2=a;
  390/ 10B : C4 08                      	ld	a, =8
  391/ 10D : CD 82                      	st	a,cnt2
  392/ 10F :                            ;	do {
  393/ 10F :                            __do014:
  394/ 10F :                            ;		a=*p2++;
  395/ 10F : C6 01                      	ld	a, @1,p2
  396/ 111 :                            ;		ascdump1();
  397/ 111 : 20 18 01                   	jsr	ascdump1
  398/ 114 :                            ;	} while(--cnt2);
  399/ 114 : 9D 82                      	dld	A,cnt2
  400/ 116 : 7C F7                      	bnz	__do014
  401/ 118 :                            __od014:
  402/ 118 :                            ;}
  403/ 118 : 5C                         	ret
  404/ 119 :                            ;
  405/ 119 :                            ;//  アスキーダンプ1byte
  406/ 119 :                            ;ascdump1()
  407/ 119 :                            ;{
  408/ 119 :                            ascdump1:
  409/ 119 :                            ;	e=a;
  410/ 119 : 48                         	ld	e,a
  411/ 11A :                            ;	if(e<0x20) {
  412/ 11A : 40                         	ld	a,e
  413/ 11B : FC 20                      	sub	a, =0x20
  414/ 11D : 64 03                      	bp	__el015
  415/ 11F :                            ;		a=' ';e=a;
  416/ 11F : C4 20                      	ld	a, =' '
  417/ 121 : 48                         	ld	e,a
  418/ 122 :                            ;	}
  419/ 122 :                            ;	if(e>=0x7f) {
  420/ 122 :                            __el015:
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 8 - 2025年01月22日 16時09分20秒


  421/ 122 : 40                         	ld	a,e
  422/ 123 : FC 7F                      	sub	a, =0x7f
  423/ 125 : 64 02                      	bp	$+4
  424/ 127 : 74 03                      	bra	__el016
  425/ 129 :                            ;		a=' ';e=a;
  426/ 129 : C4 20                      	ld	a, =' '
  427/ 12B : 48                         	ld	e,a
  428/ 12C :                            ;	}
  429/ 12C :                            ;	a=e;putc();
  430/ 12C :                            __el016:
  431/ 12C : 40                         	ld	a,e
  432/ 12D : 20 08 00                   	jsr	putc
  433/ 130 :                            ;}
  434/ 130 : 5C                         	ret
  435/ 131 :                            ;
  436/ 131 :                            ;//  大文字にする.
  437/ 131 :                            ;uc()
  438/ 131 :                            ;{
  439/ 131 :                            uc:
  440/ 131 :                            ;	e=a;
  441/ 131 : 48                         	ld	e,a
  442/ 132 :                            ;	if(e>='a') {
  443/ 132 : 40                         	ld	a,e
  444/ 133 : FC 61                      	sub	a, ='a'
  445/ 135 : 64 02                      	bp	$+4
  446/ 137 : 74 09                      	bra	__el017
  447/ 139 :                            ;		if(e<0x7b) {  // <='z'
  448/ 139 : 40                         	ld	a,e
  449/ 13A : FC 7B                      	sub	a, =0x7b
  450/ 13C : 64 04                      	bp	__el018
  451/ 13E :                            ;			a=e;
  452/ 13E : 40                         	ld	a,e
  453/ 13F :                            ;			a-=0x20;
  454/ 13F : FC 20                      	sub	a, =0x20
  455/ 141 :                            ;			return;
  456/ 141 : 5C                         	ret
  457/ 142 :                            ;		}
  458/ 142 :                            ;	}
  459/ 142 :                            __el018:
  460/ 142 :                            ;	a=e;
  461/ 142 :                            __el017:
  462/ 142 : 40                         	ld	a,e
  463/ 143 :                            ;}
  464/ 143 : 5C                         	ret
  465/ 144 :                            ;
  466/ 144 :                            ;//  小文字にする.
  467/ 144 :                            ;lc()
  468/ 144 :                            ;{
  469/ 144 :                            lc:
  470/ 144 :                            ;	e=a;
  471/ 144 : 48                         	ld	e,a
  472/ 145 :                            ;	if(e>='A') {
  473/ 145 : 40                         	ld	a,e
  474/ 146 : FC 41                      	sub	a, ='A'
  475/ 148 : 64 02                      	bp	$+4
  476/ 14A : 74 09                      	bra	__el019
  477/ 14C :                            ;		if(e<0x5b) {  // <='Z'
  478/ 14C : 40                         	ld	a,e
  479/ 14D : FC 5B                      	sub	a, =0x5b
  480/ 14F : 64 04                      	bp	__el020
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 9 - 2025年01月22日 16時09分20秒


  481/ 151 :                            ;			a=e;
  482/ 151 : 40                         	ld	a,e
  483/ 152 :                            ;			a+=0x20;
  484/ 152 : F4 20                      	add	a, =0x20
  485/ 154 :                            ;			return;
  486/ 154 : 5C                         	ret
  487/ 155 :                            ;		}
  488/ 155 :                            ;	}
  489/ 155 :                            __el020:
  490/ 155 :                            ;	a=e;
  491/ 155 :                            __el019:
  492/ 155 : 40                         	ld	a,e
  493/ 156 :                            ;}
  494/ 156 : 5C                         	ret
  495/ 157 :                            ;
  496/ 157 :                            ;
  497/ 157 :                            ;//  メモリーダンプ
  498/ 157 :                            ;mdump()
  499/ 157 :                            ;{
  500/ 157 :                            mdump:
  501/ 157 :                            ;	a=16;cnt1=a;
  502/ 157 : C4 10                      	ld	a, =16
  503/ 159 : CD 81                      	st	a,cnt1
  504/ 15B :                            ;	do {
  505/ 15B :                            __do021:
  506/ 15B :                            ;		mdump_16();
  507/ 15B : 20 62 01                   	jsr	mdump_16
  508/ 15E :                            ;	} while(--cnt1);
  509/ 15E : 9D 81                      	dld	A,cnt1
  510/ 160 : 7C F9                      	bnz	__do021
  511/ 162 :                            __od021:
  512/ 162 :                            ;}
  513/ 162 : 5C                         	ret
  514/ 163 :                            ;
  515/ 163 :                            ;//  メモリーダンプ16byte
  516/ 163 :                            ;mdump_16()
  517/ 163 :                            ;{
  518/ 163 :                            mdump_16:
  519/ 163 :                            ;	ea=p2;
  520/ 163 : 32                         	ld	ea,p2
  521/ 164 :                            ;	prhex4();
  522/ 164 : 20 8E 01                   	jsr	prhex4
  523/ 167 :                            ;	pr_spc();
  524/ 167 : 20 BE 01                   	jsr	pr_spc
  525/ 16A :                            ;
  526/ 16A :                            ;	mdump_8();
  527/ 16A : 20 7D 01                   	jsr	mdump_8
  528/ 16D :                            ;	pr_spc();
  529/ 16D : 20 BE 01                   	jsr	pr_spc
  530/ 170 :                            ;	mdump_8();
  531/ 170 : 20 7D 01                   	jsr	mdump_8
  532/ 173 :                            ;
  533/ 173 :                            ;// ASCII DUMP
  534/ 173 :                            ;	ea=p2;ea-=16;
  535/ 173 : 32                         	ld	ea,p2
  536/ 174 : BC 10 00                   	sub	ea, =16
  537/ 177 :                            ;	ascdump_16();
  538/ 177 : 20 FD 00                   	jsr	ascdump_16
  539/ 17A :                            ;
  540/ 17A :                            ;	put_crlf();
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 10 - 2025年01月22日 16時09分20秒


  541/ 17A : 20 C4 01                   	jsr	put_crlf
  542/ 17D :                            ;}
  543/ 17D : 5C                         	ret
  544/ 17E :                            ;
  545/ 17E :                            ;//  メモリーダンプ8byte
  546/ 17E :                            ;mdump_8()
  547/ 17E :                            ;{
  548/ 17E :                            mdump_8:
  549/ 17E :                            ;	a=8;cnt2=a;
  550/ 17E : C4 08                      	ld	a, =8
  551/ 180 : CD 82                      	st	a,cnt2
  552/ 182 :                            ;	do {
  553/ 182 :                            __do022:
  554/ 182 :                            ;		a=*p2++;
  555/ 182 : C6 01                      	ld	a, @1,p2
  556/ 184 :                            ;		prhex2();
  557/ 184 : 20 97 01                   	jsr	prhex2
  558/ 187 :                            ;		pr_spc();
  559/ 187 : 20 BE 01                   	jsr	pr_spc
  560/ 18A :                            ;	} while(--cnt2);
  561/ 18A : 9D 82                      	dld	A,cnt2
  562/ 18C : 7C F4                      	bnz	__do022
  563/ 18E :                            __od022:
  564/ 18E :                            ;}
  565/ 18E : 5C                         	ret
  566/ 18F :                            ;
  567/ 18F :                            ;//  EAレジスタを16進4桁表示
  568/ 18F :                            ;prhex4()
  569/ 18F :                            ;{
  570/ 18F :                            prhex4:
  571/ 18F :                            ;	a<>e;
  572/ 18F : 01                         	xch	a,e
  573/ 190 :                            ;	prhex2();
  574/ 190 : 20 97 01                   	jsr	prhex2
  575/ 193 :                            ;	a<>e;
  576/ 193 : 01                         	xch	a,e
  577/ 194 :                            ;	prhex2();
  578/ 194 : 20 97 01                   	jsr	prhex2
  579/ 197 :                            ;}
  580/ 197 : 5C                         	ret
  581/ 198 :                            ;
  582/ 198 :                            ;//  Aレジスタを16進2桁表示
  583/ 198 :                            ;prhex2()
  584/ 198 :                            ;{
  585/ 198 :                            prhex2:
  586/ 198 :                            ;	push(ea);
  587/ 198 : 08                         	push	ea
  588/ 199 :                            ;	e=a;
  589/ 199 : 48                         	ld	e,a
  590/ 19A :                            ;	a>>=1;
  591/ 19A : 3C                         	sr	a
  592/ 19B :                            ;	a>>=1;
  593/ 19B : 3C                         	sr	a
  594/ 19C :                            ;	a>>=1;
  595/ 19C : 3C                         	sr	a
  596/ 19D :                            ;	a>>=1;
  597/ 19D : 3C                         	sr	a
  598/ 19E :                            ;	prhex1();
  599/ 19E : 20 A6 01                   	jsr	prhex1
  600/ 1A1 :                            ;
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 11 - 2025年01月22日 16時09分20秒


  601/ 1A1 :                            ;	a=e;
  602/ 1A1 : 40                         	ld	a,e
  603/ 1A2 :                            ;	prhex1();
  604/ 1A2 : 20 A6 01                   	jsr	prhex1
  605/ 1A5 :                            ;	pop(ea);
  606/ 1A5 : 3A                         	pop	ea
  607/ 1A6 :                            ;}
  608/ 1A6 : 5C                         	ret
  609/ 1A7 :                            ;
  610/ 1A7 :                            ;//  Aレジスタ下位4bitのみを16進1桁表示
  611/ 1A7 :                            ;prhex1()
  612/ 1A7 :                            ;{
  613/ 1A7 :                            prhex1:
  614/ 1A7 :                            ;	push(ea);
  615/ 1A7 : 08                         	push	ea
  616/ 1A8 :                            ;	a&=0x0f;
  617/ 1A8 : D4 0F                      	and	a, =0x0f
  618/ 1AA :                            ;	e=a;
  619/ 1AA : 48                         	ld	e,a
  620/ 1AB :                            ;	if( a >= 10) {
  621/ 1AB : FC 0A                      	sub	a, =10
  622/ 1AD : 64 02                      	bp	$+4
  623/ 1AF : 74 06                      	bra	__el023
  624/ 1B1 :                            ;		a=e;a+=7;
  625/ 1B1 : 40                         	ld	a,e
  626/ 1B2 : F4 07                      	add	a, =7
  627/ 1B4 :                            ;	}else{
  628/ 1B4 : 24 B7 01                   	jmp	__fi023
  629/ 1B7 :                            __el023:
  630/ 1B7 :                            ;		a=e;
  631/ 1B7 : 40                         	ld	a,e
  632/ 1B8 :                            ;	}
  633/ 1B8 :                            __fi023:
  634/ 1B8 :                            ;	a += 0x30;
  635/ 1B8 : F4 30                      	add	a, =0x30
  636/ 1BA :                            ;	putc();
  637/ 1BA : 20 08 00                   	jsr	putc
  638/ 1BD :                            ;	pop(ea);
  639/ 1BD : 3A                         	pop	ea
  640/ 1BE :                            ;}
  641/ 1BE : 5C                         	ret
  642/ 1BF :                            ;//  空白文字を1つ出力
  643/ 1BF :                            ;pr_spc()
  644/ 1BF :                            ;{
  645/ 1BF :                            pr_spc:
  646/ 1BF :                            ;	a=' ';putc();
  647/ 1BF : C4 20                      	ld	a, =' '
  648/ 1C1 : 20 08 00                   	jsr	putc
  649/ 1C4 :                            ;}
  650/ 1C4 : 5C                         	ret
  651/ 1C5 :                            ;
  652/ 1C5 :                            ;//  改行コード出力
  653/ 1C5 :                            ;put_crlf()
  654/ 1C5 :                            ;{
  655/ 1C5 :                            put_crlf:
  656/ 1C5 :                            ;	a=0x0d;putc();
  657/ 1C5 : C4 0D                      	ld	a, =0x0d
  658/ 1C7 : 20 08 00                   	jsr	putc
  659/ 1CA :                            ;	a=0x0a;putc();
  660/ 1CA : C4 0A                      	ld	a, =0x0a
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 12 - 2025年01月22日 16時09分20秒


  661/ 1CC : 20 08 00                   	jsr	putc
  662/ 1CF :                            ;}
  663/ 1CF : 5C                         	ret
  664/ 1D0 :                            ;
  665/ 1D0 :                            ;//  文字列出力( P2 )ヌル終端.
  666/ 1D0 :                            ;puts()
  667/ 1D0 :                            ;{
  668/ 1D0 :                            puts:
  669/ 1D0 :                            ;	do {
  670/ 1D0 :                            __do024:
  671/ 1D0 :                            ;		a=*p2++;
  672/ 1D0 : C6 01                      	ld	a, @1,p2
  673/ 1D2 :                            ;		if(a==0) break;
  674/ 1D2 : 6C 05                      	bz	__od024
  675/ 1D4 :                            ;		putc();
  676/ 1D4 : 20 08 00                   	jsr	putc
  677/ 1D7 :                            ;	}while(1);	
  678/ 1D7 : 74 F7                      	bra	__do024
  679/ 1D9 :                            __od024:
  680/ 1D9 :                            ;}
  681/ 1D9 : 5C                         	ret
  682/ 1DA :                            ;
  683/ 1DA :                            ;//  文字列入力( P2 ) 0x0a + ヌル終端.
  684/ 1DA :                            ;gets()
  685/ 1DA :                            ;{
  686/ 1DA :                            gets:
  687/ 1DA :                            ;	do {
  688/ 1DA :                            __do025:
  689/ 1DA :                            ;		getc();
  690/ 1DA : 20 06 00                   	jsr	getc
  691/ 1DD :                            ;		*p2++=a;
  692/ 1DD : CE 01                      	st	a, @1,p2
  693/ 1DF :                            ;		e=a;
  694/ 1DF : 48                         	ld	e,a
  695/ 1E0 :                            ;		if(e==0x0a) break;
  696/ 1E0 : 40                         	ld	a,e
  697/ 1E1 : FC 0A                      	sub	a, =0x0a
  698/ 1E3 : 6C 07                      	bz	__od025
  699/ 1E5 :                            ;		if(e==0x0d) break;
  700/ 1E5 : 40                         	ld	a,e
  701/ 1E6 : FC 0D                      	sub	a, =0x0d
  702/ 1E8 : 6C 02                      	bz	__od025
  703/ 1EA :                            ;	}while(1);	
  704/ 1EA : 74 EE                      	bra	__do025
  705/ 1EC :                            __od025:
  706/ 1EC :                            ;
  707/ 1EC :                            ;	a=0; *p2++=a;
  708/ 1EC : C4 00                      	ld	a, =0
  709/ 1EE : CE 01                      	st	a, @1,p2
  710/ 1F0 :                            ;}
  711/ 1F0 : 5C                         	ret
  712/ 1F1 :                            ;
  713/ 1F1 :                            ;//  文字列サンプル
  714/ 1F1 :                            ;msg1:
  715/ 1F1 :                            msg1:
  716/ 1F1 :                            ;	db(" * SC/MP-III Monitor *");
  717/ 1F1 : 20 2A 20 53 43 2F 4D 50 2D 	db	" * SC/MP-III Monitor *"
       1FA : 49 49 49 20 4D 6F 6E 69 74
       203 : 6F 72 20 2A               
  718/ 207 :                            ;	db(0x0d);
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 13 - 2025年01月22日 16時09分20秒


  719/ 207 : 0D                         	db	0x0d
  720/ 208 :                            ;	db(0x0a);
  721/ 208 : 0A                         	db	0x0a
  722/ 209 :                            ;	db(0);
  723/ 209 : 00                         	db	0
  724/ 20A :                            ;
  725/ 20A :                            ;inbuf:
  726/ 20A :                            inbuf:
  727/ 20A :                            ;	ds(128);
  728/ 20A :                            	ds	128
  729/ 28A :                            ;
  730/ 28A :                            ;bufend:
  731/ 28A :                            bufend:
  732/ 28A :                            ;	db(0);
  733/ 28A : 00                         	db	0
  734/ 28B :                            ;
  735/ 28B :                            ;
  736/ 28B :                            ;// CALC PI //
  737/ 28B :                            ;
  738/ 28B :                            ;// 割り算=========
  739/ 28B :                            ;// q0/q4
  740/ 28B :                            ;
  741/ 28B :                            ;div32_16()
  742/ 28B :                            ;{
  743/ 28B :                            div32_16:
  744/ 28B :                            ;	cnt1=16;
  745/ 28B : C4 10                      	ld	a, =16
  746/ 28D : CD 81                      	st	a,cnt1
  747/ 28F :                            ;
  748/ 28F :                            ;	cyr0=0;
  749/ 28F : C4 00                      	ld	a, =0
  750/ 291 : CD B0                      	st	a,cyr0
  751/ 293 :                            ;	cyr1=0;
  752/ 293 : C4 00                      	ld	a, =0
  753/ 295 : CD B1                      	st	a,cyr1
  754/ 297 :                            ;	cyr2=0;
  755/ 297 : C4 00                      	ld	a, =0
  756/ 299 : CD B2                      	st	a,cyr2
  757/ 29B :                            ;
  758/ 29B :                            ;	do {
  759/ 29B :                            __do026:
  760/ 29B :                            ;
  761/ 29B :                            ;// === q0:q3 の32bit を左シフト(2倍)
  762/ 29B :                            ;		// q0 <<=1
  763/ 29B :                            ;		ea=q0;ea+=q0;
  764/ 29B : 85 A0                      	ld	ea,q0
  765/ 29D : B5 A0                      	add	ea,q0
  766/ 29F :                            ;		q0=ea;
  767/ 29F : 8D A0                      	st	ea,q0
  768/ 2A1 :                            ;		// sr = CY(bit7)
  769/ 2A1 :                            ;		a=0;e=a;
  770/ 2A1 : C4 00                      	ld	a, =0
  771/ 2A3 : 48                         	ld	e,a
  772/ 2A4 :                            ;		a=s;sl(ea);cyr0=ea;
  773/ 2A4 : 06                         	ld	a,s
  774/ 2A5 : 0F                         	sl	ea
  775/ 2A6 : 8D B0                      	st	ea,cyr0
  776/ 2A8 :                            ;
  777/ 2A8 :                            ;		// q2 <<=1 : q2+= .CY
  778/ 2A8 :                            ;		ea=q2;ea+=q2;ea+=cyr1;
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 14 - 2025年01月22日 16時09分20秒


  779/ 2A8 : 85 A2                      	ld	ea,q2
  780/ 2AA : B5 A2                      	add	ea,q2
  781/ 2AC : B5 B1                      	add	ea,cyr1
  782/ 2AE :                            ;		q2=ea;
  783/ 2AE : 8D A2                      	st	ea,q2
  784/ 2B0 :                            ;// === q2:q3 の16bit から q4:q5の16bit が減算できるなら減算する.
  785/ 2B0 :                            ;		ea-=q4;push(ea);
  786/ 2B0 : BD A4                      	sub	ea,q4
  787/ 2B2 : 08                         	push	ea
  788/ 2B3 :                            ;		a=e;if(a>=0) {
  789/ 2B3 : 40                         	ld	a,e
  790/ 2B4 : FC 00                      	sub	a, =0
  791/ 2B6 : 64 02                      	bp	$+4
  792/ 2B8 : 74 0D                      	bra	__el027
  793/ 2BA :                            ;			pop(ea);
  794/ 2BA : 3A                         	pop	ea
  795/ 2BB :                            ;			q2=ea; //減算結果をq2に書き戻す.
  796/ 2BB : 8D A2                      	st	ea,q2
  797/ 2BD :                            ;			// q0++
  798/ 2BD :                            ;			ea=q0;ea+=1;q0=ea;
  799/ 2BD : 85 A0                      	ld	ea,q0
  800/ 2BF : B4 01 00                   	add	ea, =1
  801/ 2C2 : 8D A0                      	st	ea,q0
  802/ 2C4 :                            ;		}else{
  803/ 2C4 : 24 C7 02                   	jmp	__fi027
  804/ 2C7 :                            __el027:
  805/ 2C7 :                            ;			pop(ea);//減算結果を破棄する.
  806/ 2C7 : 3A                         	pop	ea
  807/ 2C8 :                            ;		}
  808/ 2C8 :                            __fi027:
  809/ 2C8 :                            ;	}while(--cnt1);	
  810/ 2C8 : 9D 81                      	dld	A,cnt1
  811/ 2CA : 7C CF                      	bnz	__do026
  812/ 2CC :                            __od026:
  813/ 2CC :                            ;}
  814/ 2CC : 5C                         	ret
  815/ 2CD :                            ;
  816/ 2CD :                            ;// 割り算テスト
  817/ 2CD :                            ;div_test()
  818/ 2CD :                            ;{
  819/ 2CD :                            div_test:
  820/ 2CD :                            ;	// q0 = 12345
  821/ 2CD :                            ;	ea=12345;q0=ea;
  822/ 2CD : 84 39 30                   	ld	ea, =12345
  823/ 2D0 : 8D A0                      	st	ea,q0
  824/ 2D2 :                            ;	ea=0    ;q2=ea;
  825/ 2D2 : 84 00 00                   	ld	ea, =0
  826/ 2D5 : 8D A2                      	st	ea,q2
  827/ 2D7 :                            ;
  828/ 2D7 :                            ;	// q4 = 10
  829/ 2D7 :                            ;	ea=10   ;q4=ea;
  830/ 2D7 : 84 0A 00                   	ld	ea, =10
  831/ 2DA : 8D A4                      	st	ea,q4
  832/ 2DC :                            ;
  833/ 2DC :                            ;	// q0/q4
  834/ 2DC :                            ;	div32_16();
  835/ 2DC : 20 8A 02                   	jsr	div32_16
  836/ 2DF :                            ;
  837/ 2DF :                            ;	ea=#q0;p2=ea;mdump(); //メモリーダンプの実行.
  838/ 2DF : 84 A0 FF                   	ld	ea, =q0
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 15 - 2025年01月22日 16時09分20秒


  839/ 2E2 : 46                         	ld	p2,ea
  840/ 2E3 : 20 56 01                   	jsr	mdump
  841/ 2E6 :                            ;}
  842/ 2E6 : 5C                         	ret
  843/ 2E7 :                            
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 16 - 2025年01月22日 16時09分20秒


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
 ASCDUMP1 :                     119 C |  ASCDUMP_16 :                    FE C |
 ASCDUMP_8 :                    10B C | *BENCHMARK :                     34 C |
 BENCH_SUBR :                    51 C |  BENCH_SUBR2 :                   5D C |
*BUFEND :                       28A C | *CASESENSITIVE :                  0 - |
 CMD :                           62 C |  CNT1 :                        FF81 - |
 CNT2 :                        FF82 - | *CONSTPI :        3.141592653589793 - |
 CYR0 :                        FFB0 - |  CYR1 :                        FFB1 - |
 CYR2 :                        FFB2 - |
*DATE :             "2025\-027\-071\-07601\-026\-100\-12022\-026\-105\-091" - |
 DIV32_16 :                     28B C |  DIV_TEST :                     2CD C |
 EXIT :                           B C | *FALSE :                          0 - |
 GETC :                           7 C |  GETS :                         1DA C |
*HAS64 :                          1 - |  INBUF :                        20A C |
 LC :                           144 C | *LISTON :                         1 - |
*MACEXP :                         7 - |  MAIN :                           D C |
 MDUMP :                        157 C |  MDUMP_16 :                     163 C |
 MDUMP_8 :                      17E C | *MOMCPU :                      8070 - |
*MOMCPUNAME :                "8070" - |  MSG1 :                         1F1 C |
*NESTMAX :                      100 - |  P4 :                          FF84 - |
 P4MUL16 :                       9D C |  P5 :                          FF86 - |
 PRHEX1 :                       1A7 C |  PRHEX2 :                       198 C |
 PRHEX4 :                       18F C |  PR_SPC :                       1BF C |
 PUTC :                           9 C |  PUTS :                         1D0 C |
 PUT_CRLF :                     1C5 C |  Q0 :                          FFA0 - |
*Q1 :                          FFA1 - |  Q2 :                          FFA2 - |
*Q3 :                          FFA3 - |  Q4 :                          FFA4 - |
*Q5 :                          FFA5 - | *R0 :                          FFA8 - |
*R1 :                          FFAA - | *R2 :                          FFAC - |
*R3 :                          FFAE - |  R4 :                          FF83 - |
 READHEX :                       A8 C |  READHEX1 :                      D7 C |
*RELAXED :                        0 - |  SP_SKIP :                       8F C |
*TIME :               "16\-026\-103\-12609\-027\-120\-12220\-025\-089\-110" - |
*TRUE :                           1 - | *UC :                           131 C |
*VERSION :                     142F - | *WK1 :                         FF80 - |
 __DO001 :                       38 C |  __DO002 :                       3C C |
 __DO003 :                       55 C |  __DO014 :                      10F C |
 __DO021 :                      15B C |  __DO022 :                      182 C |
 __DO024 :                      1D0 C |  __DO025 :                      1DA C |
 __DO026 :                      29B C |  __EL004 :                       86 C |
 __EL005 :                       79 C |  __EL006 :                       8E C |
 __EL009 :                       D0 C |  __EL010 :                       EB C |
 __EL011 :                       EB C |  __EL012 :                       FB C |
 __EL013 :                       FB C |  __EL015 :                      122 C |
 __EL016 :                      12C C |  __EL017 :                      142 C |
 __EL018 :                      142 C |  __EL019 :                      155 C |
 __EL020 :                      155 C |  __EL023 :                      1B7 C |
 __EL027 :                      2C7 C | *__EW000 :                       30 C |
 __EW007 :                       9C C | *__EW008 :                       D6 C |
 __FI009 :                       D3 C |  __FI023 :                      1B8 C |
 __FI027 :                      2C8 C | *__OD001 :                       47 C |
*__OD002 :                       43 C | *__OD003 :                       5C C |
*__OD014 :                      118 C | *__OD021 :                      162 C |
*__OD022 :                      18E C |  __OD024 :                      1D9 C |
 __OD025 :                      1EC C | *__OD026 :                      2CC C |
 __WH000 :                       16 C |  __WH007 :                       91 C |
 __WH008 :                       AF C |
 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 17 - 2025年01月22日 16時09分20秒



    109 symbols
     35 unused symbols

 AS V1.42 Beta [Bld 269] - Source File moni3.asm - Page 18 - 2025年01月22日 16時09分20秒


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    843 lines source file
      2 passes
      0 errors
      0 warnings
